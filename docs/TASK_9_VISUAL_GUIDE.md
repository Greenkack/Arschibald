# Task 9: Finanzierungsinformationen - Visual Guide

## Page Layout Overview

```
┌─────────────────────────────────────────────────────────────┐
│                         PAGE 9                               │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  FINANZIERUNGSINFORMATIONEN                            │ │
│  │  (Bold, 20pt, Primary Color)                           │ │
│  │                                                         │ │
│  │  Vollständige Finanzierungsanalyse mit Kredit,        │ │
│  │  Leasing und Amortisationsplan                        │ │
│  │  (Regular, 11pt, Grey)                                │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  KREDITFINANZIERUNG                                    │ │
│  │  (Bold, 14pt, Primary Color)                           │ │
│  │                                                         │ │
│  │  ┌──────────────────────────┬──────────────────────┐  │ │
│  │  │ Position                 │ Wert                 │  │ │
│  │  ├──────────────────────────┼──────────────────────┤  │ │
│  │  │ Kreditbetrag            │ 25.000,00 €          │  │ │
│  │  │ Zinssatz                │ 4,00% p.a.           │  │ │
│  │  │ Laufzeit                │ 20 Jahre (240 Mon.)  │  │ │
│  │  │ Monatliche Rate         │ 151,49 €             │  │ │
│  │  │ Gesamtkosten            │ 36.357,60 €          │  │ │
│  │  │ Zinskosten gesamt       │ 11.357,60 €          │  │ │
│  │  └──────────────────────────┴──────────────────────┘  │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  LEASINGFINANZIERUNG                                   │ │
│  │  (Bold, 14pt, Primary Color)                           │ │
│  │                                                         │ │
│  │  ┌──────────────────────────┬──────────────────────┐  │ │
│  │  │ Position                 │ Wert                 │  │ │
│  │  ├──────────────────────────┼──────────────────────┤  │ │
│  │  │ Leasingbetrag           │ 25.000,00 €          │  │ │
│  │  │ Leasingfaktor           │ 1,20%                │  │ │
│  │  │ Laufzeit                │ 20 Jahre (240 Mon.)  │  │ │
│  │  │ Monatliche Rate         │ 300,00 €             │  │ │
│  │  │ Restwert                │ 250,00 €             │  │ │
│  │  │ Gesamtkosten            │ 72.000,00 €          │  │ │
│  │  └──────────────────────────┴──────────────────────┘  │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## Page 10: Amortization Plan

```
┌─────────────────────────────────────────────────────────────┐
│                        PAGE 10                               │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  AMORTISATIONSPLAN                                     │ │
│  │  (Bold, 14pt, Primary Color)                           │ │
│  │                                                         │ │
│  │  ┌────┬────────────┬─────────┬──────────┬───────────┐ │ │
│  │  │Jahr│Einsparungen│ Kosten  │  Netto   │Kumuliert  │ │ │
│  │  ├────┼────────────┼─────────┼──────────┼───────────┤ │ │
│  │  │ 1  │ 2.500,00 € │ 200,00€ │2.300,00€ │-22.700,00€│ │ │
│  │  │ 2  │ 2.500,00 € │ 200,00€ │2.300,00€ │-20.400,00€│ │ │
│  │  │ 3  │ 2.500,00 € │ 200,00€ │2.300,00€ │-18.100,00€│ │ │
│  │  │ 4  │ 2.500,00 € │ 200,00€ │2.300,00€ │-15.800,00€│ │ │
│  │  │ 5  │ 2.500,00 € │ 200,00€ │2.300,00€ │-13.500,00€│ │ │
│  │  │ 6  │ 2.500,00 € │ 200,00€ │2.300,00€ │-11.200,00€│ │ │
│  │  │ 7  │ 2.500,00 € │ 200,00€ │2.300,00€ │ -8.900,00€│ │ │
│  │  │ 8  │ 2.500,00 € │ 200,00€ │2.300,00€ │ -6.600,00€│ │ │
│  │  │ 9  │ 2.500,00 € │ 200,00€ │2.300,00€ │ -4.300,00€│ │ │
│  │  │ 10 │ 2.500,00 € │ 200,00€ │2.300,00€ │ -2.000,00€│ │ │
│  │  │ 11 │ 2.500,00 € │ 200,00€ │2.300,00€ │    300,00€│ │ │
│  │  │    │ ← AMORTIZATION YEAR (Highlighted in Yellow) │ │ │
│  │  └────┴────────────┴─────────┴──────────┴───────────┘ │ │
│  │                                                         │ │
│  │  Amortisationszeit: 11 Jahre                           │ │
│  │  (Bold, 10pt, Primary Color)                           │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  FINANZIERUNGSVERGLEICH                                │ │
│  │  (Bold, 14pt, Primary Color)                           │ │
│  │                                                         │ │
│  │  Barkauf                                               │ │
│  │  (Bold, 11pt)                                          │ │
│  │    Investition: 25.000,00 €                           │ │
│  │    Opportunitätskosten: 20.000,00 €                   │ │
│  │    Gesamtkosten: 45.000,00 €                          │ │
│  │                                                         │ │
│  │  Kreditfinanzierung                                    │ │
│  │  (Bold, 11pt)                                          │ │
│  │    Monatliche Rate: 151,49 €                          │ │
│  │    Gesamtkosten: 36.357,60 €                          │ │
│  │                                                         │ │
│  │  Leasingfinanzierung                                   │ │
│  │  (Bold, 11pt)                                          │ │
│  │    Monatliche Rate: 300,00 €                          │ │
│  │    Effektive Kosten: 71.750,00 €                      │ │
│  │                                                         │ │
│  │  Empfehlung: Kredit (Ersparnis: 35.392,40€)          │ │
│  │  (Bold, 12pt, Primary Color)                           │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## Color Scheme

### Primary Elements

- **Headers**: Primary Color (#1E3A8A - Dark Blue)
- **Table Headers**: Primary Color background with white text
- **Section Titles**: Primary Color, Bold

### Secondary Elements

- **Body Text**: Black (#000000)
- **Subtitles**: Grey (#666666)
- **Table Gridlines**: Light Grey (#CCCCCC)
- **Highlight (Amortization Year)**: Yellow (#FFFF00)

### Background

- **Page**: White (#FFFFFF)
- **Table Header**: Primary Color (#1E3A8A)
- **Table Rows**: White (alternating with light grey optional)

## Typography

### Font Families

- **Headers**: Helvetica-Bold
- **Body Text**: Helvetica
- **Tables**: Helvetica

### Font Sizes

- **Main Title**: 20pt (Finanzierungsinformationen)
- **Section Titles**: 14pt (Kreditfinanzierung, etc.)
- **Subsection Titles**: 11-12pt
- **Body Text**: 10-11pt
- **Table Headers**: 9-10pt (Bold)
- **Table Data**: 8-9pt
- **Subtitles**: 10-11pt

## Table Styling

### Credit & Leasing Tables

```
┌──────────────────────────┬──────────────────────┐
│ Position                 │ Wert                 │  ← Blue header, white text
├──────────────────────────┼──────────────────────┤
│ Kreditbetrag            │ 25.000,00 €          │  ← Black text
│ Zinssatz                │ 4,00% p.a.           │  ← Grey gridlines
│ Laufzeit                │ 20 Jahre (240 Mon.)  │
│ Monatliche Rate         │ 151,49 €             │
│ Gesamtkosten            │ 36.357,60 €          │
│ Zinskosten gesamt       │ 11.357,60 €          │
└──────────────────────────┴──────────────────────┘
```

### Amortization Table

```
┌────┬────────────┬─────────┬──────────┬───────────┐
│Jahr│Einsparungen│ Kosten  │  Netto   │Kumuliert  │  ← Blue header
├────┼────────────┼─────────┼──────────┼───────────┤
│ 1  │ 2.500,00 € │ 200,00€ │2.300,00€ │-22.700,00€│
│ 2  │ 2.500,00 € │ 200,00€ │2.300,00€ │-20.400,00€│
│... │    ...     │   ...   │   ...    │    ...    │
│ 11 │ 2.500,00 € │ 200,00€ │2.300,00€ │    300,00€│  ← Yellow highlight
└────┴────────────┴─────────┴──────────┴───────────┘
```

## Number Formatting

### German Format (Requirement 9.29)

- **Thousands Separator**: Dot (.)
- **Decimal Separator**: Comma (,)
- **Decimal Places**: Always 2
- **Currency Symbol**: € (after number with space)

### Examples

```
1234.56    →  1.234,56 €
25000.00   →  25.000,00 €
123456.78  →  123.456,78 €
0.00       →  0,00 €
```

## Spacing & Layout

### Vertical Spacing

- **After Main Title**: 1 cm
- **Between Sections**: 1 cm
- **After Tables**: 1 cm
- **Table Row Height**: 0.5-0.7 cm
- **Before Page Break**: Check if < 8 cm remaining

### Horizontal Spacing

- **Left Margin**: 2 cm
- **Right Margin**: 2 cm
- **Table Column Padding**: 0.2 cm
- **Text Indent**: 0.5 cm (for subsections)

### Table Dimensions

- **Credit/Leasing Tables**: 8 cm width (2 columns)
  - Column 1: Labels (flexible)
  - Column 2: Values (right-aligned)
- **Amortization Table**: Full width - 4 cm (5 columns)
  - Jahr: 2 cm
  - Einsparungen: 3 cm
  - Kosten: 3 cm
  - Netto-Cashflow: 3.5 cm
  - Kumuliert: 3.5 cm

## Page Break Logic

### Automatic Page Breaks

- **Trigger**: When remaining vertical space < 8 cm
- **Action**: Insert `c.showPage()` and reset y_pos
- **Header Repeat**: Section headers repeated on new pages
- **Continuity**: "(Fortsetzung)" added to repeated headers

### Example

```python
if y_pos < 8*cm:
    c.showPage()
    # Repeat header
    c.setFont("Helvetica-Bold", 14)
    c.drawString(2*cm, self.height - 3*cm, "Amortisationsplan (Fortsetzung)")
    y_pos = self.height - 5*cm
```

## Data Flow Diagram

```
┌─────────────────────────────────────────────────────────┐
│                    User Input / Database                 │
│  • final_end_preis (25.000 €)                           │
│  • global_constants (interest rates, durations)         │
│  • analysis_results (savings, costs)                    │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│              FinancingPageGenerator                      │
│  ┌─────────────────────────────────────────────────┐   │
│  │ _get_final_price()                              │   │
│  │   → Extracts price with priority fallback       │   │
│  └─────────────────────────────────────────────────┘   │
│                     │                                    │
│                     ▼                                    │
│  ┌─────────────────────────────────────────────────┐   │
│  │ _draw_credit_financing_section()                │   │
│  │   → calculate_annuity()                         │   │
│  │   → _draw_financing_table()                     │   │
│  └─────────────────────────────────────────────────┘   │
│                     │                                    │
│                     ▼                                    │
│  ┌─────────────────────────────────────────────────┐   │
│  │ _draw_leasing_financing_section()               │   │
│  │   → calculate_leasing_costs()                   │   │
│  │   → _draw_financing_table()                     │   │
│  └─────────────────────────────────────────────────┘   │
│                     │                                    │
│                     ▼                                    │
│  ┌─────────────────────────────────────────────────┐   │
│  │ _draw_amortization_plan()                       │   │
│  │   → Calculate 25-year cashflow                  │   │
│  │   → Highlight amortization year                 │   │
│  └─────────────────────────────────────────────────┘   │
│                     │                                    │
│                     ▼                                    │
│  ┌─────────────────────────────────────────────────┐   │
│  │ _draw_financing_comparison()                    │   │
│  │   → calculate_financing_comparison()            │   │
│  │   → Display recommendation                      │   │
│  └─────────────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                  PDF Output (2-3 pages)                  │
│  • Page 9: Header + Credit + Leasing                    │
│  • Page 10: Amortization Plan + Comparison              │
│  • Page 11+: Additional diagrams (if selected)          │
└─────────────────────────────────────────────────────────┘
```

## Error States

### Missing Price Data

```
┌─────────────────────────────────────────────────────────┐
│  ⚠️ ERROR                                                │
│                                                          │
│  Finanzierungsinformationen können nicht erstellt       │
│  werden: Kein Preis verfügbar                           │
│                                                          │
│  → Returns empty bytes (b'')                            │
│  → Logs error to ExtendedPDFLogger                      │
└─────────────────────────────────────────────────────────┘
```

### Missing Financial Tools

```
┌─────────────────────────────────────────────────────────┐
│  ⚠️ WARNING                                              │
│                                                          │
│  Finanzierungsberechnungen nicht verfügbar              │
│  (financial_tools Modul fehlt)                          │
│                                                          │
│  → Skips affected sections                              │
│  → Continues with available sections                    │
└─────────────────────────────────────────────────────────┘
```

## Best Practices

### For Developers

1. Always check `final_end_preis` availability before generation
2. Use `_format_currency()` for all monetary values
3. Implement page break checks before large content blocks
4. Log all operations for debugging
5. Handle missing data gracefully with fallbacks

### For Users

1. Ensure pricing data is complete before generating PDF
2. Configure global constants for accurate calculations
3. Review financing options in admin panel
4. Check generated PDF for accuracy
5. Use logger summary to identify any issues

---

**Visual Guide Version**: 1.0
**Last Updated**: 2025-01-10
**Compatibility**: Extended PDF Generator v2.0+
